# JSDoc Generation for .prompt.mdx Files

The AgentMark CLI now supports generating JSDoc definitions for your `.prompt.mdx` files, providing type safety and better IDE support when working with MDX files.

## What's New

- **JSDoc Generation**: Generate JSDoc type definitions from your `.prompt.mdx` input schemas
- **Type Safety**: Get IntelliSense and type checking in your MDX files
- **Automatic Updates**: Regenerate JSDoc definitions whenever your schemas change
- **MDX Analyzer Support**: Works with the [MDX Analyzer](https://github.com/mdx-js/mdx-analyzer) for enhanced IDE support

## Usage

### 1. Generate JSDoc Definitions

Use the `generate-types` command with the `--language jsdoc` option:

```bash
# Generate JSDoc from local .prompt.mdx files
agentmark generate-types --language jsdoc --root-dir ./agentmark > agentmark.jsdoc.js

# Generate JSDoc from a running AgentMark server
agentmark generate-types --language jsdoc --local 9002 > agentmark.jsdoc.js
```

### 2. Import JSDoc in Your .prompt.mdx Files

Add JSDoc import and parameter declarations at the top of your `.prompt.mdx` files:

```mdx
{/** @import {CustomerSupportProps} from './agentmark.jsdoc.js' */}
{/** @param {CustomerSupportProps} props */}

---
name: customer-support
text_config:
  model_name: gpt-4o
input_schema:
  type: object
  properties:
    customer_question:
      type: string
      description: "The customer's question or concern"
    priority:
      type: string
      description: "Priority level: low, medium, high"
  required:
    - customer_question
---

<User>
{props.customer_question}
Priority: {props.priority || "medium"}
</User>
```

### 3. Get Type Safety and IntelliSense

With the JSDoc imports in place, you'll get:
- **Autocomplete** for `props` properties
- **Type checking** for required vs optional properties
- **Hover documentation** showing property descriptions
- **Error highlighting** for invalid property access

## Generated JSDoc Format

The generated JSDoc file contains:

1. **Type Definitions**: JSDoc `@typedef` declarations for each prompt's input schema
2. **Property Documentation**: Descriptions and types for all schema properties
3. **Optional Properties**: Marked with `=` prefix for optional properties
4. **Usage Instructions**: Comments explaining how to import and use the types

### Example Generated JSDoc

```javascript
/**
 * Auto-generated JSDoc definitions from AgentMark
 * Do not edit this file directly
 */

/**
 * @typedef {Object} CustomerSupportProps
 * @property {string} customer_question - The customer's question or concern
 * @property {string} =priority - Priority level: low, medium, high
 * @property {string} =customer_id - Unique identifier for the customer
 */

/**
 * @typedef {Object} MathProps
 * @property {string} userMessage - The math problem to solve
 */
```

## IDE Setup

### VS Code with MDX Analyzer

1. Install the [MDX extension](https://marketplace.visualstudio.com/items?itemName=unifiedjs.vscode-mdx)
2. The extension will automatically pick up your JSDoc imports
3. Enjoy full type safety and IntelliSense in your `.prompt.mdx` files

### Other Editors

The JSDoc generation works with any editor that supports:
- MDX syntax highlighting
- JSDoc type analysis
- The [Language Server Protocol](https://microsoft.github.io/language-server-protocol/)

## Workflow Integration

### Development Workflow

1. **Write/Update Schemas**: Modify your `.prompt.mdx` input schemas
2. **Regenerate Types**: Run `agentmark generate-types --language jsdoc`
3. **Update Imports**: Add JSDoc imports to new `.prompt.mdx` files
4. **Develop**: Enjoy type safety while building your prompts

### Build Integration

Add JSDoc generation to your build process:

```json
{
  "scripts": {
    "generate-types": "agentmark generate-types --language jsdoc --root-dir ./agentmark > agentmark.jsdoc.js",
    "build": "npm run generate-types && your-build-command"
  }
}
```

## Type Mapping

The JSDoc generator maps JSON Schema types to JavaScript types:

| JSON Schema Type | JSDoc Type | Example |
|-----------------|------------|---------|
| `string` | `string` | `@property {string} name` |
| `number` | `number` | `@property {number} age` |
| `integer` | `number` | `@property {number} count` |
| `boolean` | `boolean` | `@property {boolean} active` |
| `array` | `Array` or `type[]` | `@property {string[]} tags` |
| `object` | `Object` | `@property {Object} metadata` |

## Benefits

### For Developers
- **Faster Development**: Autocomplete reduces typing and errors
- **Better Documentation**: Schema descriptions become inline help
- **Error Prevention**: Catch typos and missing properties early

### For Teams
- **Consistency**: Shared type definitions ensure consistent prop usage
- **Onboarding**: New team members get immediate guidance from types
- **Maintenance**: Schema changes are reflected in all prompt files

## Examples

### Basic Text Prompt

```mdx
{/** @import {WelcomeMessageProps} from './agentmark.jsdoc.js' */}
{/** @param {WelcomeMessageProps} props */}

---
name: welcome-message
text_config:
  model_name: gpt-4o
input_schema:
  type: object
  properties:
    user_name:
      type: string
      description: "The user's first name"
    company:
      type: string
      description: "The user's company name"
  required: ["user_name"]
---

<User>
Welcome {props.user_name}{props.company ? ` from ${props.company}` : ''}!
</User>
```

### Object Prompt with Complex Schema

```mdx
{/** @import {AnalysisRequestProps} from './agentmark.jsdoc.js' */}
{/** @param {AnalysisRequestProps} props */}

---
name: data-analysis
object_config:
  model_name: gpt-4o
  schema:
    type: object
    properties:
      insights:
        type: array
        items:
          type: string
      confidence:
        type: number
input_schema:
  type: object
  properties:
    data:
      type: array
      items:
        type: object
      description: "Array of data points to analyze"
    analysis_type:
      type: string
      description: "Type of analysis: trend, summary, prediction"
  required: ["data", "analysis_type"]
---

<User>
Please analyze this {props.analysis_type} data: {JSON.stringify(props.data)}
</User>
```

## Troubleshooting

### JSDoc Not Working in Editor
1. Ensure your editor supports MDX and JSDoc
2. Check that the JSDoc import path is correct
3. Restart your language server or reload the window

### Missing Autocomplete
1. Verify the JSDoc file is generated correctly
2. Check that the property names match your schema
3. Ensure the import statement is at the top of the file

### Type Errors
1. Regenerate the JSDoc file after schema changes
2. Check for typos in property names
3. Verify required properties are being used

## Migration Guide

### From No Types to JSDoc

1. **Generate Initial JSDoc**: Run the generation command
2. **Add Imports**: Add JSDoc imports to existing `.prompt.mdx` files
3. **Fix Issues**: Address any type errors revealed by the JSDoc
4. **Update Workflow**: Add generation to your build process

### From TypeScript to JSDoc

If you were using TypeScript types:

1. **Generate JSDoc**: Use the new `--language jsdoc` option
2. **Update Imports**: Change from TypeScript imports to JSDoc imports
3. **Compare Types**: Ensure JSDoc types match your previous TypeScript types
4. **Test**: Verify that type safety still works as expected

## Contributing

To improve JSDoc generation:

1. **Report Issues**: File bugs for incorrect type mappings
2. **Suggest Enhancements**: Propose new JSDoc features
3. **Test Edge Cases**: Try complex schemas and report problems
4. **Improve Documentation**: Help make this guide better

---

The JSDoc generation feature brings TypeScript-like type safety to your MDX files, making AgentMark development more productive and error-free. Happy coding! ðŸš€